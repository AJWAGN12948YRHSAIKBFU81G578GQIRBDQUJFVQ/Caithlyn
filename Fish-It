local Version = "1.6.53"
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/download/" ..
Version .. "/main.lua"))()


--// Global Function
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local net = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")
local VirtualUser = game:GetService("VirtualUser")
local Constants = require(ReplicatedStorage:WaitForChild("Shared", 20):WaitForChild("Constants"))

_G.Characters = workspace:FindFirstChild("Characters"):WaitForChild(LocalPlayer.Name)
_G.HRP = _G.Characters:WaitForChild("HumanoidRootPart")
_G.Overhead = _G.HRP:WaitForChild("Overhead")
_G.Header = _G.Overhead:WaitForChild("Content"):WaitForChild("Header")
_G.LevelLabel = _G.Overhead:WaitForChild("LevelContainer"):WaitForChild("Label")
local Player = Players.LocalPlayer
_G.XPBar = Player:WaitForChild("PlayerGui"):WaitForChild("XP")
_G.XPLevel = _G.XPBar:WaitForChild("Frame"):WaitForChild("LevelCount")
_G.Title = _G.Overhead:WaitForChild("TitleContainer"):WaitForChild("Label")
_G.TitleEnabled = _G.Overhead:WaitForChild("TitleContainer")

if Player and VirtualUser then
    Player.Idled:Connect(function()
        pcall(function()
            VirtualUser:CaptureController(); VirtualUser:ClickButton2(Vector2.new())
        end)
    end)
end

local character = Players.LocalPlayer.Character or Players.LocalPlayer.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local autoFishWasOn = false

local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")

--// Config Loader
local CONFIG_FOLDER = "CaithlynConfig"
local CONFIG_FILE   = "settings.json"

local function ensureFolder()
    if not isfolder or not writefile then return false end
    if not isfolder(CONFIG_FOLDER) then
        makefolder(CONFIG_FOLDER)
    end
    return true
end

local function getConfigPath()
    return CONFIG_FOLDER .. "/" .. CONFIG_FILE
end

local function loadConfig()
    if not ensureFolder() then return {} end
    local path = getConfigPath()
    if not isfile(path) then return {} end

    local ok, data = pcall(function()
        return HttpService:JSONDecode(readfile(path))
    end)
    if ok and typeof(data) == "table" then
        return data
    end
    return {}
end

local function saveConfig(cfg)
    if not ensureFolder() then return end
    local path = getConfigPath()
    local ok, encoded = pcall(function()
        return HttpService:JSONEncode(cfg)
    end)
    if ok then
        writefile(path, encoded)
    end
end

local Config = loadConfig()

local function setFlag(key, value)
    Config[key] = value
    saveConfig(Config)
end

--// Service and Modules
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local LocalPlayer = Players.LocalPlayer

local net = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_net@0.2.0")
    :WaitForChild("net")

local Replion = _G.Replion or require(ReplicatedStorage.Packages.Replion)
local ItemUtility = _G.ItemUtility or require(ReplicatedStorage.Shared.ItemUtility)
local ItemStringUtility = _G.ItemStringUtility or require(ReplicatedStorage.Modules.ItemStringUtility)

local InitiateTrade = net:WaitForChild("RF/InitiateTrade")
local RFUpdateAutoFishingState = net:WaitForChild("RF/UpdateAutoFishingState")
local RFCancelFishingInputs = net:WaitForChild("RF/CancelFishingInputs")

local Shared = ReplicatedStorage:WaitForChild("Shared", 5)
local Modules = ReplicatedStorage:WaitForChild("Modules", 5)

if Shared then
    if not _G.ItemUtility then
        local success, utility = pcall(require, Shared:WaitForChild("ItemUtility", 5))
        if success and utility then
            _G.ItemUtility = utility
        else
            warn("ItemUtility module not found or failed to load.")
        end
    end
    if not _G.ItemStringUtility and Modules then
        local success, stringUtility = pcall(require, Modules:WaitForChild("ItemStringUtility", 5))
        if success and stringUtility then
            _G.ItemStringUtility = stringUtility
        else
            warn("ItemStringUtility module not found or failed to load.")
        end
    end

    if not _G.Replion then pcall(function() _G.Replion = require(ReplicatedStorage.Packages.Replion) end) end
    if not _G.Promise then pcall(function() _G.Promise = require(ReplicatedStorage.Packages.Promise) end) end
    if not _G.PromptController then pcall(function() _G.PromptController = require(ReplicatedStorage.Controllers.PromptController) end) end
end


--// Notifications Log
local function NotifySuccess(title, message, duration)
    WindUI:Notify({
        Title = title,
        Content = message,
        Duration = duration,
        Icon = "circle-check"
    })
end

local function NotifyError(title, message, duration)
    WindUI:Notify({
        Title = title,
        Content = message,
        Duration = duration,
        Icon = "ban"
    })
end

local function NotifyInfo(title, message, duration)
    WindUI:Notify({
        Title = title,
        Content = message,
        Duration = duration,
        Icon = "info"
    })
end

local function NotifyWarning(title, message, duration)
    WindUI:Notify({
        Title = title,
        Content = message,
        Duration = duration,
        Icon = "triangle-alert"
    })
end

--// Window Loader
WindUI:AddTheme({
    Name = "Deep Sea Dawn",
    Accent = WindUI:Gradient({
        ["0"]   = { Color = Color3.fromHex("#FFC700"), Transparency = 0 },
        ["100"] = { Color = Color3.fromHex("#00BFFF"), Transparency = 0 },
    }, {
        Rotation = 45,
    }),
    Dialog = Color3.fromHex("#082A4D"),     
    Outline = Color3.fromHex("#9BCFFF"),    
    Text = Color3.fromHex("#E0F4FF"),       
    Placeholder = Color3.fromHex("#5B8CA3"),
    Background = Color3.fromHex("#051930"), 
    Button = Color3.fromHex("#176FA8"),     
    Icon = Color3.fromHex("#FFD75F")        
})

local Window = WindUI:CreateWindow({
    Title = "Caithlyn",
    Icon = "crown",
    Author = "by Einhard.",
    Folder = "Caithlyn",
    Size = UDim2.fromOffset(600, 400),
    Transparent = false,
    Theme = "Deep Sea Dawn",
    ToggleKey = Enum.KeyCode.K,
    KeySystem = false,
    ScrollBarEnabled = true,
    HideSearchBar = true,
    NewElements = true,
    User = {
        Enabled = true,
        Anonymous = false,
        Callback = function()
        end,
    }
})

--// Open Button
Window:EditOpenButton({
    Title = "Caithlyn",
    Icon = "crown",
    CornerRadius = UDim.new(0, 30),
    StrokeThickness = 2,
    Color = ColorSequence.new(
        Color3.fromHex("FFD75F"),
        Color3.fromHex("082A4D")
    ),
    Draggable = true,
})

--// TabList
local Automatic = Window:Tab({
    Title = 'Automatic',
    Icon = 'play'
})

local Teleport = Window:Tab({
    Title = 'Teleport',
    Icon = 'navigation'
})

local Trade = Window:Tab({
    Title = "Trade",
    Icon = "handshake"
})

--// Automatic Tab Features
Automatic:Section({ Title = 'Automation' })

--// Enable Toggle & Equip Rod
local function enableAutoFishingAndEquipRod()
    local hasRod = char:FindFirstChild("!!!FISHING_VIEW_MODEL!!!")
    task.wait(0.5)

    if hasRod then
        pcall(function()
            local VIM = game:GetService("VirtualInputManager")
            VIM:SendKeyEvent(true, Enum.KeyCode.One, false, game)
            task.wait(0.5)
            VIM:SendKeyEvent(false, Enum.KeyCode.One, false, game)
            task.wait(0.5)
        end)
    end
    
    if not autoFishWasOn then return end
    task.wait(0.5)

    pcall(function()
        if RFUpdateAutoFishingState and RFUpdateAutoFishingState:IsA("RemoteFunction") then
            RFUpdateAutoFishingState:InvokeServer(true)
        end
    end)
    
    task.wait(0.5)
end

--// Force Cancel Function
local function forceCancelFishing()
    pcall(function()
        if RFCancelFishingInputs and RFCancelFishingInputs:IsA("RemoteFunction") then
            RFCancelFishingInputs:InvokeServer()
        end
    end)
    
    task.wait(0.3)
    
    pcall(function()
        if RFUpdateAutoFishingState and RFUpdateAutoFishingState:IsA("RemoteFunction") then
            RFUpdateAutoFishingState:InvokeServer(false)
        end
    end)
    
    task.wait(0.3)
    
    enableAutoFishingAndEquipRod()
end

--// Auto Fish

local function getRemote(path)
    local remote = ReplicatedStorage:FindFirstChild("Packages")
    if not remote then return nil end
    
    remote = remote:FindFirstChild("_Index")
    if not remote then return nil end
    
    remote = remote:FindFirstChild("sleitnick_net@0.2.0")
    if not remote then return nil end
    
    remote = remote:FindFirstChild("net")
    if not remote then return nil end
    
    if path == "autofish" then
        remote = remote:FindFirstChild("RF/UpdateAutoFishingState")
    end
    
    return remote
end

local function enableAutoFish()
    task.spawn(function()
        while autoFishWasOn do
            local char = Players.LocalPlayer.Character
            if not char then return end
            
            local hasRod = char:FindFirstChild("!!!FISHING_VIEW_MODEL!!!")
            task.wait(0.5)

            if hasRod then
                local VIM = game:GetService("VirtualInputManager")
                VIM:SendKeyEvent(true, Enum.KeyCode.One, false, game)
                task.wait(0.5)
                VIM:SendKeyEvent(false, Enum.KeyCode.One, false, game)
                task.wait(0.5)
            end

            if not autoFishWasOn then return end

            task.wait(0.5)

            local remote = getRemote("autofish")
            if remote and remote:IsA("RemoteFunction") then
                pcall(function()
                    remote:InvokeServer(true)
                end)
            end
        end
    end)
end

Automatic:Toggle({
    Title = 'Auto Fish',
    Desc = 'Fishing mode legit.',
    Value = Config.AutoFish == true,
    Callback = function(isOn)
        autoFishWasOn = isOn
        setFlag("AutoFish", isOn)

        if isOn then 
            enableAutoFish()
        else
            task.spawn(function()
                local remote = getRemote("autofish")
                if remote and remote:IsA("RemoteFunction") then
                    pcall(function()
                        remote:InvokeServer(false)
                    end)
                end
            end)
        end
    end
})

if Config.AutoFish then
    autoFishWasOn = true
    enableAutoFish()
end

--// Auto Sell
local autoSellRunning = false
local autoSellWasOn = false
local autoSellThreshold = 100

local function getFishCount()
    local root = Players.LocalPlayer:FindFirstChild("PlayerGui")
    if not root then return 0 end

    for _, gui in ipairs(root:GetChildren()) do
        if gui:IsA("ScreenGui") then
            for _, child in ipairs(gui:GetDescendants()) do
                if child:IsA("TextLabel") and child.Name == "BagSize" and child.Visible then
                    local match = child.Text:match("([%d,]+)%s*/")
                    if match then
                        match = match:gsub(",", ""):gsub("%s+", "")
                        return tonumber(match)
                    end
                end
            end
        end
    end
    return 0
end

local function sellAllFish()
    pcall(function()
        local pkg = ReplicatedStorage:FindFirstChild("Packages")
        if not pkg then return end

        local idx = pkg:FindFirstChild("_Index")
        if not idx then return end

        local sleitnick = idx:FindFirstChild("sleitnick_net@0.2.0")
        if not sleitnick then return end

        local netFolder = sleitnick:FindFirstChild("net")
        if not netFolder then return end

        for _, obj in ipairs(netFolder:GetDescendants()) do
            if (obj:IsA("RemoteFunction") or obj:IsA("RemoteEvent")) then
                local nameLower = obj.Name:lower()
                if nameLower:find("sell") or (nameLower:find("rf/") and nameLower:find("sell")) then
                    pcall(function()
                        if obj:IsA("RemoteFunction") then
                            obj:InvokeServer()
                        else
                            obj:FireServer()
                        end
                    end)
                end
            end
        end

        local function tryInvokeByName(n)
            local candidate = netFolder:FindFirstChild(n)
            if candidate then
                pcall(function()
                    if candidate:IsA("RemoteFunction") then
                        candidate:InvokeServer()
                    elseif candidate:IsA("RemoteEvent") then
                        candidate:FireServer()
                    end
                end)
            end
        end

        tryInvokeByName("RF/SellAllItems")
        tryInvokeByName("SellAllItems")
        tryInvokeByName("RF/SellItem")
        tryInvokeByName("SellItem")
    end)
end

local function autoSellLoop()
    task.spawn(function()
        while autoSellRunning do
            task.wait(8)
            if getFishCount() >= autoSellThreshold then
                sellAllFish()
                task.wait(0.5)
            end
        end
    end)
end

Automatic:Toggle({
    Title = 'Auto Sell',
    Desc = 'Auto Selling Fish',
    Value = Config.AutoSell == true,
    Callback = function(isOn)
        autoSellWasOn = isOn
        autoSellRunning = isOn
        setFlag("AutoSell", isOn)

        if isOn then
            autoSellLoop()
        end
    end
})

if Config.AutoSell then
    autoSellWasOn = true
    autoSellRunning = true
    autoSellLoop()
end

--// Respawn Handler
Players.LocalPlayer.CharacterAdded:Connect(function()
    task.wait(0.5)
    
    autoSellRunning = false
    
    if autoFishWasOn then 
        enableAutoFish() 
    end
    
    if autoSellWasOn then 
        autoSellRunning = true
        autoSellLoop() 
    end
end)

--// FPS Boost Tab Feature
Automatic:Section({ Title = 'Performance' })

local fpsBoostEnabled = false
local originalSettings = {}

local function saveLightingSettings()
    originalSettings.Lighting = {
        Brightness = game:GetService("Lighting").Brightness,
        GlobalShadows = game:GetService("Lighting").GlobalShadows,
        Technology = game:GetService("Lighting").Technology,
        Ambient = game:GetService("Lighting").Ambient,
        OutdoorAmbient = game:GetService("Lighting").OutdoorAmbient,
        FogEnd = game:GetService("Lighting").FogEnd,
        FogStart = game:GetService("Lighting").FogStart,
        ClockTime = game:GetService("Lighting").ClockTime,
        GeographicLatitude = game:GetService("Lighting").GeographicLatitude,
    }
    
    originalSettings.RenderSettings = {
        QualityLevel = settings().Rendering.QualityLevel,
        MeshPartDetailLevel = settings().Rendering.MeshPartDetailLevel,
    }
    
    originalSettings.LightingEffects = {}
    for _, effect in ipairs(game:GetService("Lighting"):GetChildren()) do
        if effect:IsA("PostEffect") or effect:IsA("Atmosphere") or effect:IsA("Sky") or effect:IsA("Clouds") then
            table.insert(originalSettings.LightingEffects, effect:Clone())
        end
    end
end

local function enableFPSBoost()
    local Lighting = game:GetService("Lighting")
    
    saveLightingSettings()
    
    settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
    settings().Rendering.MeshPartDetailLevel = Enum.MeshPartDetailLevel.Level01
    
    pcall(function()
        game:GetService("UserSettings"):GetService("UserGameSettings").SavedQualityLevel = Enum.SavedQualitySetting.QualityLevel1
    end)
    
    Lighting.GlobalShadows = false
    Lighting.Brightness = 3
    Lighting.Technology = Enum.Technology.Compatibility
    Lighting.Ambient = Color3.fromRGB(255, 255, 255)
    Lighting.OutdoorAmbient = Color3.fromRGB(255, 255, 255)
    Lighting.FogEnd = 9e9
    Lighting.FogStart = 0
    Lighting.ClockTime = 12
    Lighting.GeographicLatitude = 0
    
    for _, effect in ipairs(Lighting:GetChildren()) do
        pcall(function()
            if effect:IsA("PostEffect") or effect:IsA("Atmosphere") or effect:IsA("Sky") or effect:IsA("Clouds") then
                effect:Destroy()
            end
        end)
    end
    
    pcall(function()
        workspace.Terrain.WaterTransparency = 1
        workspace.Terrain.WaterReflectance = 0
        workspace.Terrain.WaterWaveSize = 0
        workspace.Terrain.WaterWaveSpeed = 0
        workspace.Terrain.Decoration = false
    end)
    
    local function optimizeObject(obj)
        pcall(function()
            if obj:IsA("ParticleEmitter") or obj:IsA("Trail") or obj:IsA("Smoke") or 
               obj:IsA("Fire") or obj:IsA("Sparkles") or obj:IsA("Explosion") or
               obj:IsA("Beam") then
                obj:Destroy()
                return
            end
            
            if obj:IsA("PointLight") or obj:IsA("SpotLight") or obj:IsA("SurfaceLight") then
                obj:Destroy()
                return
            end
            
            if obj:IsA("Decal") or obj:IsA("Texture") or obj:IsA("SurfaceAppearance") then
                obj:Destroy()
                return
            end
            
            if obj:IsA("SpecialMesh") or obj:IsA("FileMesh") or obj:IsA("CylinderMesh") or 
               obj:IsA("BlockMesh") then
                obj:Destroy()
                return
            end
            
            if obj:IsA("Accessory") or obj:IsA("Hat") then
                obj:Destroy()
                return
            end
            
            if obj:IsA("BasePart") then
                obj.Material = Enum.Material.SmoothPlastic
                obj.Reflectance = 0
                obj.CastShadow = false
                
                if not obj:FindFirstAncestorOfClass("Model") or obj:FindFirstAncestorOfClass("Model").Name ~= Players.LocalPlayer.Name then
                    obj.Color = Color3.fromRGB(200, 200, 200)
                end
            end
            
            if obj:IsA("Shirt") or obj:IsA("Pants") or obj:IsA("ShirtGraphic") then
                obj:Destroy()
                return
            end
            
            if obj:IsA("BodyColors") then
                obj.HeadColor3 = Color3.fromRGB(255, 220, 177)
                obj.TorsoColor3 = Color3.fromRGB(200, 200, 200)
                obj.LeftArmColor3 = Color3.fromRGB(200, 200, 200)
                obj.RightArmColor3 = Color3.fromRGB(200, 200, 200)
                obj.LeftLegColor3 = Color3.fromRGB(150, 150, 150)
                obj.RightLegColor3 = Color3.fromRGB(150, 150, 150)
            end
            
            if obj:IsA("CharacterMesh") then
                obj:Destroy()
                return
            end
        end)
    end
    
    task.spawn(function()
        for _, obj in ipairs(workspace:GetDescendants()) do
            if not fpsBoostEnabled then break end
            optimizeObject(obj)
        end
    end)
    
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character then
            task.spawn(function()
                for _, obj in ipairs(player.Character:GetDescendants()) do
                    optimizeObject(obj)
                end
            end)
        end
    end
    
    workspace.DescendantAdded:Connect(function(obj)
        if not fpsBoostEnabled then return end
        task.wait(0.3)
        optimizeObject(obj)
    end)
    
    Players.PlayerAdded:Connect(function(player)
        if not fpsBoostEnabled then return end
        player.CharacterAdded:Connect(function(char)
            task.wait(0.5)
            if not fpsBoostEnabled then return end
            for _, obj in ipairs(char:GetDescendants()) do
                optimizeObject(obj)
            end
        end)
    end)
    
end

local function disableFPSBoost()
    local Lighting = game:GetService("Lighting")
    
    if originalSettings.Lighting then
        pcall(function()
            Lighting.Brightness = originalSettings.Lighting.Brightness
            Lighting.GlobalShadows = originalSettings.Lighting.GlobalShadows
            Lighting.Technology = originalSettings.Lighting.Technology
            Lighting.Ambient = originalSettings.Lighting.Ambient
            Lighting.OutdoorAmbient = originalSettings.Lighting.OutdoorAmbient
            Lighting.FogEnd = originalSettings.Lighting.FogEnd
            Lighting.FogStart = originalSettings.Lighting.FogStart
            Lighting.ClockTime = originalSettings.Lighting.ClockTime
            Lighting.GeographicLatitude = originalSettings.Lighting.GeographicLatitude
        end)
    end
    
    if originalSettings.RenderSettings then
        pcall(function()
            settings().Rendering.QualityLevel = originalSettings.RenderSettings.QualityLevel or Enum.QualityLevel.Automatic
            settings().Rendering.MeshPartDetailLevel = originalSettings.RenderSettings.MeshPartDetailLevel or Enum.MeshPartDetailLevel.Automatic
        end)
    end
    
    if originalSettings.LightingEffects then
        for _, effect in ipairs(originalSettings.LightingEffects) do
            pcall(function()
                effect:Clone().Parent = Lighting
            end)
        end
    end
    
    pcall(function()
        workspace.Terrain.WaterTransparency = 0.3
        workspace.Terrain.WaterReflectance = 1
        workspace.Terrain.WaterWaveSize = 0.15
        workspace.Terrain.WaterWaveSpeed = 10
        workspace.Terrain.Decoration = true
    end)
    
end

Automatic:Toggle({
    Title = 'FPS Boost',
    Desc = 'Make GPU more saver',
    Value = Config.FPSBoost == true,
    Callback = function(isOn)
        fpsBoostEnabled = isOn
        setFlag("FPSBoost", isOn)

        if isOn then
            enableFPSBoost()
        else
            disableFPSBoost()
        end
    end
})

if Config.FPSBoost then
    fpsBoostEnabled = true
    enableFPSBoost()
end

Players.LocalPlayer.CharacterAdded:Connect(function()
    if fpsBoostEnabled then
        task.wait(0.5)
        enableFPSBoost()
    end
end)

--// Auto Clicker Tab Feature
Automatic:Section({ Title = "Auto Clicker" })

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local VIM = game:GetService("VirtualInputManager")

local autoClickerRunning = false
local clickerSpeed = 50

local TAP_X_RATIO = 0.7
local TAP_Y_RATIO = 0.78

local function getNetFolder()
    local pkg = ReplicatedStorage:FindFirstChild("Packages")
    if not pkg then return nil end
    local idx = pkg:FindFirstChild("_Index")
    if not idx then return nil end
    local sleitnick = idx:FindFirstChild("sleitnick_net@0.2.0")
    if not sleitnick then return nil end
    return sleitnick:FindFirstChild("net")
end

local netFolder = getNetFolder()
local RFRequestMinigame, REMinigameChanged

if netFolder then
    RFRequestMinigame = netFolder:FindFirstChild("RF/RequestFishingMinigameStarted")
    REMinigameChanged = netFolder:FindFirstChild("RE/FishingMinigameChanged")
end

local function clickTapArea()
    local cam = workspace.CurrentCamera
    if not cam then return end

    local size = cam.ViewportSize
    local x = size.X * TAP_X_RATIO
    local y = size.Y * TAP_Y_RATIO

    pcall(function()
        VIM:SendMouseButtonEvent(x, y, 0, true, game, 0)
        task.wait(0.01)
        VIM:SendMouseButtonEvent(x, y, 0, false, game, 0)
    end)
end

local function autoClickerLoop()
    task.spawn(function()
        while autoClickerRunning do
            clickTapArea()
            task.wait(0.05)
        end
    end)
end

Automatic:Toggle({
    Title = "Enable Auto Clicker",
    Desc = "Manually start/stop auto clicker",
    Value = Config.AutoClicker == true,
    Callback = function(isOn)
        autoClickerRunning = isOn
        setFlag("AutoClicker", isOn)

        if isOn then
            autoClickerLoop()
        end
    end
})

if Config.AutoClicker then
    autoClickerRunning = true
    autoClickerLoop()
end

--// Respawn Handler
Players.LocalPlayer.CharacterAdded:Connect(function()
    if autoClickerRunning then
        task.wait(1)
        autoClickerLoop()
    end
end)

--// Teleport Tab Feature
local islands = {
    { Name = "Lost Isle", Position = Vector3.new(-3739.66, -135.07, -1010.27), LookAt = Vector3.new(-3710.56, -105.45, -895.97) },
    { Name = "Tropical", Position = Vector3.new(-2176.73, 5.87, 3654.82), LookAt = Vector3.new(-2166.86, 5.87, 3656.45) },
    { Name = "Creater", Position = Vector3.new(975.36, 2.17, 5021.63), LookAt = Vector3.new(980.01, 2.17, 5030.49) },
    { Name = "Esoteric", Position = Vector3.new(3207.41, -1302.86, 1444.84), LookAt = Vector3.new(3250.56, -1302.86, 1419.57) },
    { Name = "Treasure", Position = Vector3.new(-3611.89, -279.07, -1589.51), LookAt = Vector3.new(-3619.21, -286.53, -1602.57) }
}

Teleport:Section({Title = 'Teleport to Island'})
local activeIslandIndex = nil
local toggleRefs = {}
local toggleStates = {}

for i, island in ipairs(islands) do
    toggleStates[i] = false
    
    toggleRefs[i] = Teleport:Toggle({
        Title = island.Name,
        Value = false,
        Callback = function(state)
            toggleStates[i] = state

            if state then
                for j, toggle in ipairs(toggleRefs) do
                    if j ~= i then
                        toggle:Set(false)
                        toggleStates[j] = false
                    end
                end
            
                activeIslandIndex = i
                setFlag("ActiveIsland", island.Name)
            
                local character = Players.LocalPlayer.Character
                if character and character:FindFirstChild("HumanoidRootPart") then
                    character.HumanoidRootPart.CFrame = CFrame.new(island.Position, island.LookAt)
                end
            else
                if activeIslandIndex == i then
                    activeIslandIndex = nil
                    setFlag("ActiveIsland", nil)
                end
            end
        end
    })
end

if Config.ActiveIsland then
    for i, island in ipairs(islands) do
        if island.Name == Config.ActiveIsland then
            toggleRefs[i]:Set(true)
            break
        end
    end
end

Players.LocalPlayer.CharacterAdded:Connect(function(character)
    
    if activeIslandIndex and toggleStates[activeIslandIndex] then
        local island = islands[activeIslandIndex]
        
        character:WaitForChild("HumanoidRootPart")
        task.wait(0.5)
        
        if character and character:FindFirstChild("HumanoidRootPart") then
            character.HumanoidRootPart.CFrame = CFrame.new(island.Position, island.LookAt)
        end
    end
end)

--// Trade Tab Feature
Trade:Section({ Title = "Secret Auto Trade" })

--// Auto Accept Trade
pcall(function()
    local PromptController = _G.PromptController or ReplicatedStorage:WaitForChild("Controllers").PromptController
    local Promise = _G.Promise or require(ReplicatedStorage.Packages.Promise)

    if PromptController and PromptController.FirePrompt then
        local oldFirePrompt = PromptController.FirePrompt
        
        PromptController.FirePrompt = function(self, promptText, ...)
            if _G.AutoAcceptTradeEnabled
                and type(promptText) == "string"
                and promptText:find("Accept")
                and promptText:find("from:") then

                return Promise.new(function(resolve)
                    forceCancelFishing()
                    task.wait(0.5)
                    resolve(true)
                end)
            end

            return oldFirePrompt(self, promptText, ...)
        end
    end
end)

Trade:Toggle({
    Title = "Enable Auto Accept Trade",
    Desc = "Automatically accepts incoming trade requests (with anti-stuck).",
    Value = Config.AutoAcceptTrade == true,
    Callback = function(value)
        _G.AutoAcceptTradeEnabled = value
        setFlag("AutoAcceptTrade", value)

        if value then
            NotifySuccess("Auto Accept", "Auto accept trade enabled.", 3)
        else
            NotifyWarning("Auto Accept", "Auto accept trade disabled.", 3)
        end
    end
})

if Config.AutoAcceptTrade then
    _G.AutoAcceptTradeEnabled = true
end

--// Player Target
local tradeState = {
    selectedPlayerName = Config.TradeTargetName or nil,
    selectedPlayerId = Config.TradeTargetId or nil,
    autoTrade = false,
    loopEnabled = false,
    isTradingNow = false
}

local function getPlayerList()
    local list = {}
    for _, p in ipairs(Players:GetPlayers()) do
        if p ~= LocalPlayer then
            table.insert(list, p.Name)
        end
    end
    table.sort(list)
    return list
end

local function refreshPlayerDropdown()
    if _G.PlayerDropdownTradeSimple then
        _G.PlayerDropdownTradeSimple:Refresh(getPlayerList())
    end
end

local playerDropdown = Trade:Dropdown({
    Title = "Select Trade Target",
    Values = getPlayerList(),
    Value = Config.TradeTargetName or (getPlayerList()[1] or nil),
    SearchBarEnabled = true,
    Callback = function(selected)
        tradeState.selectedPlayerName = selected
        local player = Players:FindFirstChild(selected)
        if player then
            tradeState.selectedPlayerId = player.UserId
            setFlag("TradeTargetName", selected)
            setFlag("TradeTargetId", player.UserId)
            NotifySuccess("Target Selected", "Target set to: " .. player.Name, 3)
        else
            tradeState.selectedPlayerId = nil
            NotifyError("Target Error", "Player not found!", 3)
        end
    end
})
_G.PlayerDropdownTradeSimple = playerDropdown

if Config.TradeTargetName then
    local targetPlayer = Players:FindFirstChild(Config.TradeTargetName)
    if targetPlayer then
        tradeState.selectedPlayerName = Config.TradeTargetName
        tradeState.selectedPlayerId = targetPlayer.UserId
        NotifyInfo("Auto Target", "Target restored: " .. Config.TradeTargetName, 3)
    end
end

Players.PlayerAdded:Connect(function()
    task.delay(0.1, refreshPlayerDropdown)
end)
Players.PlayerRemoving:Connect(function()
    task.delay(0.1, refreshPlayerDropdown)
end)

--// Check Inventory
local function getSecretFishUUIDs()
    local DataReplion = Replion.Client:WaitReplion("Data")
    if not DataReplion then
        return {}
    end

    local inventoryItems = DataReplion:Get({ "Inventory", "Items" })
    if not inventoryItems then return {} end

    local uuids = {}

    for _, itemData in ipairs(inventoryItems) do
        if not itemData.Favorited then
            local baseItemData = ItemUtility:GetItemData(itemData.Id)
            if baseItemData and baseItemData.Data and baseItemData.Data.Type == "Fish" then
                local tier = baseItemData.Data.Tier or 1
                if tier == 7 or tier == 6 then
                    table.insert(uuids, {
                        UUID = itemData.UUID,
                        Name = ItemStringUtility.GetItemName(itemData, baseItemData),
                        Tier = tier
                    })
                end
            end
        end
    end

    return uuids
end

--// Auto Trade Running
local statusParagraph = Trade:Paragraph({
    Title = "Status",
    Desc = "Waiting to start..."
})

local function startSecretAutoTradeLoop()
    task.spawn(function()
        while tradeState.loopEnabled do
            if not tradeState.selectedPlayerId then
                statusParagraph:SetDesc("Error: No trade target set!")
                task.wait(3)
                break
            end

            local secretList = getSecretFishUUIDs()
            local count = #secretList

            if count == 0 then
                statusParagraph:SetDesc("Inventory empty. Waiting 60s before next check...")
                task.wait(60)
                continue
            end

            tradeState.isTradingNow = true

            statusParagraph:SetDesc("Found " .. count .. " secret fish! Starting trade...")
            task.wait(0.5)

            local targetId = tradeState.selectedPlayerId
            local targetName = tradeState.selectedPlayerName or tostring(targetId)
            local totalSent = 0

            while tradeState.loopEnabled do
                secretList = getSecretFishUUIDs()
                count = #secretList
                
                if count == 0 then
                    statusParagraph:SetDesc("All secret fish traded! Inventory is now empty.")
                    break
                end

                for i, item in ipairs(secretList) do
                    if not tradeState.loopEnabled then
                        statusParagraph:SetDesc("Trade loop stopped by user.")
                        tradeState.isTradingNow = false
                        enableAutoFishingAndEquipRod()
                        return
                    end

                    statusParagraph:SetDesc(string.format(
                        "Sending %d/%d to %s\n%s",
                        i, count, targetName, item.Name
                    ))

                    forceCancelFishing()
                    task.wait(0.5)

                    local ok, result = pcall(function()
                        return InitiateTrade:InvokeServer(targetId, item.UUID)
                    end)

                    if ok and result then
                        totalSent = totalSent + 1
                    end

                    task.wait(0.5)
                end

                statusParagraph:SetDesc("Waiting 3s to recheck inventory...")
                task.wait(3)
            end

            tradeState.isTradingNow = false
            enableAutoFishingAndEquipRod()
            
            if tradeState.loopEnabled then
                statusParagraph:SetDesc(string.format(
                    "Batch complete! Sent %d fish to %s.\nFishing resumed. Next check in 60s...",
                    totalSent, targetName
                ))
                task.wait(60)
            end
        end

        tradeState.isTradingNow = false
        enableAutoFishingAndEquipRod()
        statusParagraph:SetDesc("Auto trade loop stopped. Fishing resumed.")
    end)
end

Trade:Toggle({
    Title = "Auto Trade Loop (Secret)",
    Desc = "Continuously send all non-favorited SECRET fish. Auto-pauses fishing during trade.",
    Value = Config.AutoTradeLoop == true,
    Callback = function(state)
        tradeState.loopEnabled = state
        setFlag("AutoTradeLoop", state)

        if state then
            if not tradeState.selectedPlayerId then
                NotifyError("Auto Trade", "Please select a trade target first.", 3)
                tradeState.loopEnabled = false
                return
            end
            startSecretAutoTradeLoop()
            NotifySuccess("Auto Trade", "Auto trade loop started.", 5)
        else
            if tradeState.isTradingNow then
                enableAutoFishingAndEquipRod()
            end
            NotifyWarning("Auto Trade", "Auto trade loop stopped.", 3)
        end
    end
})

if Config.AutoTradeLoop and Config.TradeTargetId then
    task.wait(1)
    local targetPlayer = Players:FindFirstChild(Config.TradeTargetName)
    if targetPlayer then
        tradeState.loopEnabled = true
        startSecretAutoTradeLoop()
        NotifySuccess("Auto Trade", "Trade loop auto-started with saved target.", 5)
    else
        NotifyWarning("Auto Trade", "Saved target not found in server.", 5)
    end
end
